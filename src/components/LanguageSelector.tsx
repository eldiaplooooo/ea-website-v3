import React, { createContext, useContext, useState, useEffect } from 'react';
import { Globe } from 'lucide-react';

// Define the available languages
const languages = [
  { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
  { code: 'de', name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
  { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ðŸ‡¸ðŸ‡¦' }
];

// Simplified translation dictionary for bolt.new
const translations: Record<string, Record<string, string>> = {
  en: {
    'nav.home': 'Home',
    'nav.solutions': 'Solutions',
    'nav.method': 'The EA Method',
    'nav.why': 'Why EA Solutions?',
    'nav.contact': 'Contact',
    'header.cta': 'Book AI Strategy Call',
    'hero.title': 'Your Business Has a Body. We Build Its Mind.',
    'hero.subtitle': 'We architect bespoke AI infrastructures that eradicate repetitive work, amplify human potential, and unlock unprecedented efficiency.',
    'footer.description': 'We architect bespoke AI infrastructures that eradicate repetitive work, amplify human potential, and unlock unprecedented levels of efficiency.',
    'footer.cta': 'Book Your AI Strategy Call',
    'footer.quickLinks': 'Quick Links',
    'footer.contactInfo': 'Contact Information',
    'footer.rights': 'All rights reserved',
    'footer.privacy': 'Privacy Policy',
    'footer.legal': 'Legal Notice',
    'industry.gastronomy': 'Gastronomy & Hospitality',
    'industry.industrial': 'Industrial Manufacturing',
    'industry.finance': 'Finance & Security',
    'industry.finance.status': 'Coming Soon',
    'industry.smart': 'Smart Living',
    'industry.healthcare': 'Healthcare',
    'industry.retail': 'Retail',
    'industry.retail.status': 'Coming Soon'
  },
  de: {
    'nav.home': 'Startseite',
    'nav.solutions': 'LÃ¶sungen',
    'nav.method': 'Die EA-Methode',
    'nav.why': 'Warum EA Solutions?',
    'nav.contact': 'Kontakt',
    'header.cta': 'KI-Strategieanruf buchen',
    'hero.title': 'Ihr Unternehmen hat einen KÃ¶rper. Wir bauen seinen Verstand.',
    'hero.subtitle': 'Wir entwickeln maÃŸgeschneiderte KI-Infrastrukturen, die repetitive Arbeit beseitigen, menschliches Potenzial verstÃ¤rken und beispiellose Effizienz freisetzen.',
    'footer.description': 'Wir entwickeln maÃŸgeschneiderte KI-Infrastrukturen, die repetitive Arbeit beseitigen, menschliches Potenzial verstÃ¤rken und beispiellose Effizienzsteigerungen ermÃ¶glichen.',
    'footer.cta': 'Buchen Sie Ihren KI-Strategieanruf',
    'footer.quickLinks': 'Schnelllinks',
    'footer.contactInfo': 'Kontaktinformationen',
    'footer.rights': 'Alle Rechte vorbehalten',
    'footer.privacy': 'Datenschutz',
    'footer.legal': 'Impressum',
    'industry.gastronomy': 'Gastronomie & Gastgewerbe',
    'industry.industrial': 'Industrielle Fertigung',
    'industry.finance': 'Finanzen & Sicherheit',
    'industry.finance.status': 'DemnÃ¤chst',
    'industry.smart': 'Smart Living',
    'industry.healthcare': 'Gesundheitswesen',
    'industry.retail': 'Einzelhandel',
    'industry.retail.status': 'DemnÃ¤chst'
  },
  ar: {
    'nav.home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
    'nav.solutions': 'Ø§Ù„Ø­Ù„ÙˆÙ„',
    'nav.method': 'Ù…Ù†Ù‡Ø¬ÙŠØ© EA',
    'nav.why': 'Ù„Ù…Ø§Ø°Ø§ EA SolutionsØŸ',
    'nav.contact': 'Ø§ØªØµÙ„ Ø¨Ù†Ø§',
    'header.cta': 'Ø§Ø­Ø¬Ø² Ù…ÙƒØ§Ù„Ù…Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
    'hero.title': 'Ø¹Ù…Ù„Ùƒ Ù„Ù‡ Ø¬Ø³Ø¯. Ù†Ø­Ù† Ù†Ø¨Ù†ÙŠ Ø¹Ù‚Ù„Ù‡.',
    'hero.subtitle': 'Ù†Ø­Ù† Ù†ØµÙ…Ù… Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø®ØµØµØ© ØªÙ‚Ø¶ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±ØŒ ÙˆØªØ¹Ø²Ø² Ø§Ù„Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø´Ø±ÙŠØ©ØŒ ÙˆØªØ·Ù„Ù‚ Ø§Ù„Ø¹Ù†Ø§Ù† Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ØºÙŠØ± Ù…Ø³Ø¨ÙˆÙ‚Ø© Ù…Ù† Ø§Ù„ÙƒÙØ§Ø¡Ø©.',
    'footer.description': 'Ù†Ø­Ù† Ù†ØµÙ…Ù… Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø®ØµØµØ© ØªÙ‚Ø¶ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±ØŒ ÙˆØªØ¹Ø²Ø² Ø§Ù„Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø´Ø±ÙŠØ©ØŒ ÙˆØªØ·Ù„Ù‚ Ø§Ù„Ø¹Ù†Ø§Ù† Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ØºÙŠØ± Ù…Ø³Ø¨ÙˆÙ‚Ø© Ù…Ù† Ø§Ù„ÙƒÙØ§Ø¡Ø©.',
    'footer.cta': 'Ø§Ø­Ø¬Ø² Ù…ÙƒØ§Ù„Ù…Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
    'footer.quickLinks': 'Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©',
    'footer.contactInfo': 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„',
    'footer.rights': 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©',
    'footer.privacy': 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©',
    'footer.legal': 'Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ',
    'industry.gastronomy': 'Ø§Ù„Ø¶ÙŠØ§ÙØ© ÙˆØ§Ù„Ù…Ø·Ø§Ø¹Ù…',
    'industry.industrial': 'Ø§Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ',
    'industry.finance': 'Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†',
    'industry.finance.status': 'Ù‚Ø±ÙŠØ¨Ù‹Ø§',
    'industry.smart': 'Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ©',
    'industry.healthcare': 'Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©',
    'industry.retail': 'Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªØ¬Ø²Ø¦Ø©',
    'industry.retail.status': 'Ù‚Ø±ÙŠØ¨Ù‹Ø§'
  }
};

// Define the language context
interface LanguageContextType {
  language: string;
  setLanguage: (lang: string) => void;
  translate: (key: string) => string;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

// Custom hook to use the language context
export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
};

// Language Provider component
interface LanguageProviderProps {
  children: React.ReactNode;
}

export const LanguageSelector: React.FC = () => {
  const { language, setLanguage } = useLanguage();
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center space-x-1 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-300"
        aria-label="Select language"
      >
        <Globe className="h-5 w-5 text-gray-600 dark:text-gray-400" />
        <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
          {languages.find(lang => lang.code === language)?.flag}
        </span>
      </button>
      
      {isOpen && (
        <div className="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50">
          {languages.map((lang) => (
            <button
              key={lang.code}
              onClick={() => {
                setLanguage(lang.code);
                setIsOpen(false);
              }}
              className={`w-full text-left px-4 py-2 flex items-center space-x-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${
                language === lang.code ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400' : 'text-gray-700 dark:text-gray-300'
              }`}
            >
              <span className="text-xl">{lang.flag}</span>
              <span className="text-sm font-medium">{lang.name}</span>
            </button>
          ))}
        </div>
      )}
    </div>
  );
};

export const LanguageProvider: React.FC<LanguageProviderProps> = ({ children }) => {
  const [language, setLanguage] = useState(() => {
    // Try to get the language from localStorage for bolt.new
    try {
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage && languages.some(lang => lang.code === savedLanguage)) {
        return savedLanguage;
      }
    } catch {
      // Ignore localStorage errors in bolt.new
    }
    
    const browserLang = navigator.language.split('-')[0];
    return languages.some(lang => lang.code === browserLang) ? browserLang : 'en';
  });

  useEffect(() => {
    try {
      localStorage.setItem('language', language);
    } catch {
      // Ignore localStorage errors in bolt.new
    }
  }, [language]);

  const translate = (key: string): string => {
    return translations[language]?.[key] || translations['en'][key] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, translate }}>
      {children}
    </LanguageContext.Provider>
  );
};

export default LanguageSelector;